name: Official Files Sync

on:
  schedule:
    - cron: '0 22 * * *'  # UTC时间22点（北京时间6点）
  workflow_dispatch:       # 可选：允许手动触发

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Target Repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          path: target

      - name: Clean Old Files
        run: |
          # 强制删除旧文件（忽略是否存在）
          rm -rf target/OfficialFiles/*
          
      - name: Download Fresh Files
        run: |
          # 重新创建目录并下载最新文件
          mkdir -p target/OfficialFiles
          curl -fsSL -o target/OfficialFiles/lazy.conf https://raw.githubusercontent.com/LOWERTOP/Shadowrocket/main/lazy.conf
          curl -fsSL -o target/OfficialFiles/lazy_group.conf https://raw.githubusercontent.com/LOWERTOP/Shadowrocket/main/lazy_group.conf
          curl -fsSL -o target/OfficialFiles/Manual.md https://raw.githubusercontent.com/LOWERTOP/Shadowrocket/main/README.md

      - name: Commit Changes
        run: |
          cd target
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add --all
          git commit --allow-empty -m "Daily Force Sync: $(date -u +'%Y-%m-%d %H:%M:%S')"
          git push origin HEAD
